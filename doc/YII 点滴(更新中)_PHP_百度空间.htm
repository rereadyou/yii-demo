<!--STATUS OK-->


<html><head><meta http-equiv=content-type content="text/html; charset=gb2312">
<title>YII 点滴(更新中)_PHP_百度空间      </title>

<style type="text/css">
    .error{color:#FF0000;font-size:12px}
    .shareUser,.shareLastEditor{line-height:20px;color:#666666;text-align:left}
    .shareLastEditor{margin:5px 0 8px;}
</style>

<script type="text/javascript">
    var g_pageTimerStart=new Date().getTime();
</script>

<script type="text/javascript" src="/ui/scripts/global.js"></script>
<script type="text/javascript" src="/static/common/scripts/libs.js"></script>
<script type="text/javascript" src="http://img.baidu.com/js/tangram-1.1.0.js"></script>


<script type="text/javascript">
var Session = {
    isLogin: ! true,
    isHost: "",
    userName: "48238398",   
    userPortrait:'356534383233383339387202',
    spaceURL: "/48238398",
    spBasicURL:"48238398",
    spBasicURLEnc:"48238398",
    visitorName:    "",
    visitorPortrait:'00000000',
    isActive: '',   
    visitorURL: "/index.html",        // 
    pageURL: "http://hi.baidu.com/48238398/blog/item/7f5f72ad3679bc044a36d634%2Ehtml",    
    refer: "http://hi.baidu.com/sys/search?type=1&sort=1&entry=1&region=4&hi=48238398&word=yii",
    spToken: '73e111e722dd6740a7d9bf92cbc0f78d', 
    spFriendDomain: 'http://frd.baidu.com',
    spSpaceDomain: 'http://hi.baidu.com',
    spPortraitDomain: '',
    spSpaceStaticDomain: 'http://hi.baidu.com' 

    ,isDrag:  false  
    ,isProfile:  false   
    };
</script>

</head>

<body>

<center>

<script type="text/javascript">
/*<![CDATA[*/
if(top.location != self.location){
	top.location = self.location;
}
var myref = encodeURIComponent("http://hi.baidu.com/48238398/blog/item/7f5f72ad3679bc044a36d634%2Ehtml");
/*]]>*/
</script>
<link rel="stylesheet" type="text/css" href="/ui/css/mods.css" />

<link rel="stylesheet" type="text/css" href="http://hitn.bdimg.com/48238398/css/item/7c8f01a71db1b195d043584a.css" />

<link rel="stylesheet" type="text/css" href="/space.css" />

<div class="userbar">
    <div id="nav">
        <a class="logo" href="http://hi.baidu.com/index.htm"><img src="http://img.baidu.com/hi/img/ihome/logo.gif" border="0" alt="图片" /></a>



        <div class="manage">
            <form action="https://passport.baidu.com/?login" method="post">
                用户名:<input type="text" name="username" />&nbsp;&nbsp; 
                密码:<input type="password" name="password" /> 
                <input type="hidden" name="mem_pass" value="on" />
                <input type="submit" value="" style="width:0; height:0;" />
                <a href="#" class="loginlink" onclick="this.parentNode.submit(); return false;">登录</a>  
            </form> 
            <a href="/reg/new" class="reglink">注册</a>
        </div>

    </div>
</div>

 <script type='text/javascript' src='http://hi.bdimg.com/static/base/js/conf/base.js?v=20110503'></script>
 <link rel='stylesheet' type='text/css' href='http://hi.bdimg.com/static/base/css/base.css?v=20110503'/>


		


<!-- 顶部气泡操作 -->
<script type="text/javascript">
/*<![CDATA[*/
/*var close_tip = (function(){
        var tip, tip_is_closed = false;
        var is_tracker_attached = false;
        function showTip(){
        if(tip_is_closed){
        BdEvent.removeEvent(window, "resize", showTip);
        return false;
        }
        if(!is_tracker_attached){
        BdUtil.hi_tracker("tip", "m_promotion_tip");
        is_tracker_attached = true;
        }
        var hi_index = document.getElementById('hi_index'),
        left_offset = 0;
        tip = tip || document.getElementById('tip');
        do{
        left_offset += hi_index.offsetLeft;
        }while(hi_index = hi_index.offsetParent);

        tip.style.left = (left_offset - 160 )+ "px";
        tip.style.top = '15px';
        tip.style.display = 'block';
        }
        BdEvent.addEvent(window, "load", showTip);
        BdEvent.addEvent(window, "resize", showTip);



        return function(e){
            // console.log(e);
            var e = window.event || e;

            // e.returnValue = false;
            e.cancelBubble = true;
            if(e.stopPropagation)
                e.stopPropagation();

            set_cookie_4_bdtip(1, String(parseInt("1281931486") + 10));
            tip.style.display = 'none';
            tip_is_closed = true;
        }
})();*/


function set_cookie_4_bdtip(index/* start from one */, value){
	var bdtip = document.cookie.match(/(^| )BDTIP=([^;]*)(;|$)/);
	if(!bdtip){
		bdtip=new Array(index);
		for(var i=0,n=bdtip.length;i<n;i++)
		{
			if(bdtip[i]=="" || bdtip[i]==null)  bdtip[i]=0;
			if(i == index - 1){
				bdtip[i] = value;
			}
		}
	}else{
	bdtip = bdtip[2].split('-');
	if(index > bdtip.length)  bdtip.length= index;
	for(var i = 0, j = bdtip.length; i < j; i ++){
		if(bdtip[i]=="" || bdtip[i]==null) bdtip[i]=0;
		if(i == index - 1){
			bdtip[i] = value;
		}
	}
	}
	bdtip = bdtip.join('-');
	document.cookie = "BDTIP=" + bdtip+ ";expires=Wed, 28-Nov-37 01:45:46 GMT;path=/;";
}

/*]]>*/
</script>

<!-- <div id="tip" style="display:none;">
    <img src="http://img.baidu.com/hi/img/mfu/arrow.gif" id="arrow"/>
    <div id="container">
        <div class="header"></div>
        <div class="wrapper">
            <img src="http://img.baidu.com/hi/img/mfu/close.gif" class="close" onclick="close_tip(event)"/>
            <div class="main">
                <div class="title">欢乐暑期，玩游戏送大礼！</div>
                <div class="content">众多精品游戏火爆上线~<br>神秘礼品派发中，先抢先得！</div>
                <div class="more-action">
                    
                    &nbsp;<a href="http://act.hi.baidu.com/appsummer10" target="_blank" onclick="close_tip(event)">赶快来抢！</a>&nbsp;
                    
                </div>
            </div>
        </div>
    </div>
</div> -->


<div id="main" align="left">

<!--[if IE]>
<script>
var objmain = document.getElementById("main");
function updatesize(){ var bodyw = window.document.body.offsetWidth; if(bodyw <= 790) objmain.style.width="772px"; else if(bodyw >= 1016) objmain.style.width="996px"; else objmain.style.width="100%"; }
updatesize(); window.onresize = updatesize;
</script>
<![endif]-->

	<div id="header">

	<div class="lc"><div class="rc"></div></div>
<div class="tit"><a href="/48238398/home" class="titlink" title="48238398的空间 http://hi.baidu.com/48238398">PHP</a></div>
<div class="desc">PHP+MYSQL+LINUX+JAVASCRIPT+DIV+CSS+AS3+FLEX+EXTJS+YIIFRAMEWORK  QQ:48238398</div>
<div id="tabline">&nbsp;</div>

	<div id="tab"><a href="/48238398/home">主页</a><a href="/48238398/blog" class="on">博客</a><a href="/48238398/album">相册</a><span>|</span><a href="/48238398/profile">个人档案</a>

	<span>|</span><a href="/48238398/friends">好友</a>


<span>|</span><a href="http://tieba.baidu.com/i/sys/jump?un=48238398&fr=spacebar" onclick="BdUtil.ns_trackerLink('m_20110330_spacebar','')" target="_blank">i贴吧</a>


	</div>

</div>



<div class="stage">

<div class="stagepad">

<div style="width:100%">


<table width="100%" border="0" cellspacing="0" cellpadding="0" class="modth">

	<tr><td class="modtl" width="7">&nbsp;</td>

	<td class="modtc" nowrap><div class="modhead"><span class="modtit">查看文章</span></div></td>

	<td class="modtc" nowrap align="right"></td>

	<td class="modtr" width="7">&nbsp;</td>

	</tr></table>



<div id="m_blog" class="modbox" style="overflow-x:hidden;">

<div class="tit">

YII 点滴(更新中)</div>

<div class="date">2010-08-02  09:14</div>




<table style="table-layout:fixed;width:100%"><tr><td><div id="blog_text" class="cnt" >YII 点滴(更新中)2010-08-02 09:14一、从yii权威指中学到的<br><br>db组件 'schemaCachingDuration'=&gt;3600, 为什么不起做用？<br>需要开缓存<br><br>如何在页面下边显示sql的查询时间<br>在log组件的routes中加入<br>array(<br>'class'=&gt;'CProfileLogRoute',<br>'levels'=&gt;'error, warning',<br>)<br>同时在db组件中加入<br>'enableProfiling'=&gt;true,<br>同时在这种情况下，可以用CDbConnection::getStats() 查看执行了多少个语句，用了多少时间<br><br>如何知道某一个程序段运行需要的时间<br>配置好CProfileLogRoute后，在需要测试的地方加上<br>Yii::beginProfile('blockID');<br>//程序段<br>Yii::endProfile('blockID');<br><br><br>'enableParamLogging'=&gt;true,的作用是？<br>在日志的bind的参数后边跟数的值<br><br>如何在页面底部显示所有的db相关的日志<br>同上,配置log组件的routes中加入<br>array(<br>'class'=&gt;'CWebLogRoute',<br>'levels'=&gt;'trace, info, error, warning',<br>'categories' =&gt; 'system.db.*',<br>//'showInFireBug' =&gt; true, 将在firebug中显示日志<br>),<br><br>把日志记录到数据库<br>array(<br>'class'=&gt;'CDbLogRoute',<br>'logTableName'=&gt;'applog',<br>'connectionID'=&gt;'db',<br>),<br>运行时表applog会自动生成，如果不能生成，参照api自已建立<br><br>如何记录$_GET,$_SESSION等信息，在以上的routes中各个配置中加上<br>'filter'=&gt;'CLogFilter',<br><br>log配置中的level设置不对，可能会得不到日志信息<br>另外level,category的值可以随便写，<br>只要在用yii::Log("","自定义level","自定义的category")时对应起来即可<br><br><br>如何记录更详细的信息，能记录stack,在入口文件中加上<br>define('YII_TRACE_LEVEL',10);数字越大，记当的越详细,结果如下<br>[15:31:57.226][trace][system.db.CDbCommand] Querying SQL: SHOW COLUMNS FROM `Bangdan` in E:\APMServ5.2.6\www\htdocs\dayouhui.com\protected\models\Bangdan.php (21) <br><br>in E:\APMServ5.2.6\www\htdocs\dayouhui.com\protected\components\HotBangdan.php (21) in E:\APMServ5.2.6<br><br><br>如果在调试时，终止程序运行且看到日志，不能用die及exit;<br>用application::end，即Yii::app()-&gt;end(),其会触发onEndRequest事件，日志就是在这个事件中记录的<br>activeRecord几个占位方法重写的注意点<br>必须带boolean返回值<br><br><br>如何发布一个资源文件并引用<br>$css=Yii::app()-&gt;getAssetManager()-&gt;publish(dirname(__FILE__)."/aa.css");<br>yii::app()-&gt;clientScript-&gt;registerCssFIle($css);<br><br><br>如果改变activelable中默认的标题<br>重写方法attributeLabels<br><br>过滤不良代码<br>$purifier=new CHtmlPurifier;<br>$purifier-&gt;options=array("HTML.Allowed"=&gt;"div");<br>$content=$purifier-&gt;purify($content);<br>或者<br>&lt;?php $this-&gt;beginWidget('CHtmlPurifier'); ?&gt;<br>...display user-entered content here...<br>&lt;?php $this-&gt;endWidget(); ?&gt;<br><br><br>如何防止重复提交？<br>提交后<br>Ccontroler-&gt;refresh();<br><br>如何在成功后显示一个提示，用户刷新页时去掉提示<br>Cwebuser-&gt;setFlash();<br>getFlash();<br>如何防止重复提交， 并在提交成功后给出提示?<br>控制器中<br>Yii::app()-&gt;user-&gt;setFlash('submit','thanks');<br>$this-&gt;refresh();<br>view中<br>if(Yii::app()-&gt;user-&gt;hasFlash('submit')){<br><br>echo Yii::app()-&gt;user-&gt;getFlash('submit');<br>}<br>一般我们是跳转到列表页，或用redirect跳到编辑页，就不需要了，如果还是要显示当前页<br>以上就有用了，比如在当前时显示，编辑或添加新的记录<br><br><br>如何分页<br><br>itemCount总记录条数<br><br>CPagination代表分页信息,有多少页，每页几条记录等<br>CLinkPager生成分页的代码,自定义css可以给属性cssFile一个值<br>$criteria=new CDbCriteria();<br>$pages=new CPagination("数据库中的总记录数");<br>$pages-&gt;pageSize=2;<br>$pages-&gt;applyLimit($criteria);//给$criteria-&gt;limit offset等符值<br>$posts=Post::model()-&gt;findAll($criteria);<br>$this-&gt;widget('CLinkPager',array('pages'=&gt;$pages));<br><br><br>列表如何排序<br>$criteria=new CDbCriteria();<br>$sort = new CSort('Post');<br>$sort-&gt;defaultOrder=" status asc";<br>$sort-&gt;applyOrder($criteria);<br>$posts=Post::model()-&gt;findAll($criteria);<br>应用时用<br>$sort-&gt;link('字段名')<br>实际是生成一个带参数的url,然后在在applyOrder时应用这些参数修改$criteria,得到相应的查寻结果<br><br>如何生成并验证验证码:<br>基本用法<br>&lt;?php $this-&gt;widget('CCaptcha'); ?&gt;&nbsp; 具体参数查手册<br>原理CCaptcha这个widget会在run时调用当前控制器的$captchaAction='captcha'方法,这个方法指到一个类CCaptchaAction<br>其会生成验证码图象,并记入到session中<br><br>如何显示静态页<br>重写actions<br>'help'=&gt;array(<br>'class'=&gt;'CViewAction',<br>'basePath'=&gt;'help', //指定目录名<br>'defaultView'=&gt;'default',<br>'viewParam'=&gt;'help' //get参数<br>),<br>假定当前控制器是post<br>那么可以能过/post/help/help/content访问help目录下的content.php<br>可以建立子目录比如help/reigterhelp/content.那可以通过/post/help/help/registerhelp.content来访问<br>用CViewAction的好处时，可以与其它的view共享layout<br><br><br>关于没有权限访问跳转的url相关<br>当没有权限时调用CAccessControlFilter类中的accessDenied，其调用CwebUser中的loginRequired()，记录当前的returnurl后跳转到<br>CWebUser配置中的loginurl，在此处登陆后,可以通过redirect跳转到returnurl(Yii::app()-&gt;request-&gt;redirect(Yii::app()-&gt;user-&gt;returnUrl);)<br>当强制显示登陆表单，比如判断用户是guest就一直列出登陆表单，不会调用loginRequired, 就得不到returnurl，这时候想跳回去，参见<br>cookbook上相关贴子<br><br><br>registerCoreScript<br>在framework/web/js/package.php中列出的才是<br><br><br>多对多关联条件<br><br>$criteria-&gt;addInCondition("categorys.id",$in);<br>$criteria-&gt;addSearchCondition('Shop.name',$keyword);<br><br>$shops=Shop::model()-&gt;with(array("categorys"=&gt;array('together'=&gt;true)))-&gt;findAll($criteria);<br>同时要在Shop模型中加入alias="categorys" ,另外together=true放在模型的关联中也可<br><br><br>YII中的RBAC权限,用数据库存item，<br><br>在system/web/auth下找到相应的sql导放到数据库中<br>配置'authManager' =&gt; array(<br>'class' =&gt; 'CDbAuthManager',<br>'connectionID' =&gt; 'db',<br>),<br>如果在sql中导入的三个表的表名不是默认的，需要在这上边的配置中配置，具体的看api<br><br>$auth=Yii::app()-&gt;authManager;<br>//$auth-&gt;createOperation("post",'postpost');<br>//$auth-&gt;createTask("post","posts");<br>$auth-&gt;createRole("post","post");<br>auth-&gt;assign("post",'demo');<br>if(Yii::app()-&gt;user-&gt;checkAccess("post")){<br>echo "yes";<br>else{<br>echo "no";<br>}<br>这种情况下三者是一样的<br><br>如何获得上一页的url以返回<br>Yii::app()-&gt;request-&gt;urlReferrer;<br><br><br><br>accessControl 是Ccontroller中内置的过滤方法，其它的还有ajaxOnly postOnly<br><br>CMaskedTextField此组件用于限制用户的输入,对应的jquery插件http://digitalbush.com/projects/masked-input-plugin/<br><br>在一对多，多对多查询时,the eager loading 联合所有的表生成一条语句,如果主表有limit的查询选项，那么他将单独执行,然后再执行与关联表有关的语句，返回相关表的数据对象,这<br><br>就是为什么在做大优惠时，以中间表为查询条件出错的原因,解决办法<br>with()返回 CActiveFinder对象，其方法together()，既使主表中有LIMIT/OFFSET 也是返回一条sql;<br><br>多对多查询时，分页有时候页中显示的条数不正确，因为有重复的项，加上$criteria-&gt;group = true即可<br><br>模型的rules中，验证某个字段不能重复,array('name', 'unique','message' =&gt; '有重复的名子'),<br><br>CStatePersister是yii的核心组件，提供了基于文件的数据保存方式，可以不在同的请求中使用<br><br>COutputCache 即是一个组件，又是一个filter,前者的时候用于在view中缓存内容，后者的时候用于在controller中缓存<br>就是说片段缓存，是把COutputCache当一个widget来用，页面缓存把COutputCache当作一个filter来用<br>动态缓存，用CController的一个方法 renderDynamic($callback);<br><br>COutputCache几个属性,duration,dependency<br>另外还有几个，可以通称为Variation， 有什么作用呢？<br>在beginCache是需要手工指定一个id，Variation的作有就是自动给生成这个id<br><br>在布署模式的时候，有错误不会有stack样的提示，会显示一个errorxxx的错误<br><br>如何在程序有错的时候跳到指定的action<br>在components中设置<br>'errorHandler'=&gt;array(<br>'errorAction'=&gt;'site/error',<br>),<br>在此action中可以能过Yii::app()-&gt;errorHandler-&gt;error获得错误信息<br><br><br>把字符串分解成数组，并去掉空值<br>preg_split('/\s*,\s*/','this , is , , a test',-1,PREG_SPLIT_NO_EMPTY )<br><br>CActiveRecord::exits();判断有没有这样的记录，一般用于添加时，判断某字段有没有重复<br><br>CActiveDataProvider 一个基于ActiveRecord的数据提供源<br>常用的用法<br>$dataProvider=new CActiveDataProvider('Post', array(<br>'criteria'=&gt;array(),<br>'pagination'=&gt;array(),<br>'sort'=&gt;array(),&nbsp;&nbsp; &nbsp;<br>));<br>上如'sort'=&gt;array(<br>'defaultOrder'=&gt;'status, update_time DESC',<br>),<br><br>ClistView同上结合使用,其中的_view中可以用一个$data的变量，代表当前的model数据<br>如果dataProvider中的pagination,sort设为false，则CliveView中对应的部分也无法使用<br>$this-&gt;widget('zii.widgets.ClistView',array(<br>'dataProvider' =&gt; $dataprovider,<br>'itemView' =&gt; '_view',<br>'template' =&gt; '{items}{sorter}{pager}',<br>'sortableAttributes' =&gt; array(<br>),<br>));<br><br>CGridView的使用也结合$dataprovider,<br>用的时候主要是对columns的配置，主要有<br>CDataColumn, CLinkColumn, CButtonColumn and CCheckBoxColumn.具体用法看api<br>总的说来CgridView没有ClistView灵活<br><br>插入meta信息<br>Yii::app()-&gt;clientScript-&gt;registerMetaTag('keywords','关键字');<br>Yii::app()-&gt;clientScript-&gt;registerMetaTag('description','一些描述');<br><br>CMap::mergeArray() 比array_merge更智能的合并数组，yii中配置的合并用这个 <br><br><br>CClipWidget 通过ob_start ob_getconent生成一段不显示的内容，可以能过CController::clips访问，如<br>$this-&gt;beginWidget('CClipWidget',array('id'=&gt;'name','renderClip'=&gt;true));<br>可以通过$this-&gt;clips['name']来显示，其中的renderClip如果为false,则在当前位置不显示内容<br><br><br>如果在Model一次验证多个属于，显示不同的内容？如下&nbsp; [后来发现这个不起作有]<br>return array(<br>array('title, content', 'required',<br>'message'=&gt;'Please enter a value for {attribute}.'),<br>// ... other rules<br>);<br><br><br>获得服务器时间<br>$_SERVER['REQUEST_TIME']<br><br>维护程序时，这样子所有的请求转发到一个地方<br>'catchAllRequest'=&gt;array('site/all'),<br><br>根据二级域名缓存<br>array(<br>'COutputCache + search',<br>'duration' =&gt; 120,<br>'varyByParam' =&gt; array('q','page'),<br>'varyByExpression' =&gt; "app()-&gt;request-&gt;hostInfo",<br>),<br><br>有多个分站时，同步登陆，基于cookie<br>'user'=&gt;array(<br>'identityCookie'=&gt;array('domain'=&gt;'.dayouhui.com'),<br>'allowAutoLogin' =&gt; true,<br>)<br>如果是基本于session<br><br>'session' =&gt; array(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br>'cookieParams' =&gt; array('domain' =&gt; '.dayouhui', 'lifetime' =&gt; 0),<br>'timeout' =&gt; 3600,<br>),<br><br>如何使用theme<br>在main.php中配置<br>'theme'=&gt;'classic',<br>如何得到前前使用的主题<br>Yii::app()-&gt;theme<br>得到名子<br>Yii::app()-&gt;theme-&gt;name;<br>themes文件夹和protected是同级的，其下边某个theme的目录结果同protected/views下一样<br><br>关于skin<br>用theme改变view的外观，skin是用来改变widgets的外观的<br>skin是健值对用于初始化一个widget的属性<br>要对widget使用skin，需要做以下几步<br>1：配置'widgetFactory'=&gt;array(<br>'enableSkin'=&gt;true,<br>),<br><br>2:在views下建立skins目录<br>3:在skins目录下建立与Widget名子一样的php文件,返回数组，即能用于widget的初始配置<br>4:在php文件中，如果有defautl的配置，会先找这个skin<br>5:如果应用了theme，程序会先去对应的theme目录下的skins中找配置文件<br>6:如果只是想给widget统一一个skin，建议用Customizing Widgets Globally<br><br><br><br>如果防止post跨站攻击<br>'request'=&gt;array(<br>'enableCsrfValidation'=&gt;true,<br>),<br>这时候生成的表单要用CHtml::form(),其会写一段代码在cookie中<br><br><br>防止Cookie攻击 <br>'request'=&gt;array(<br>'enableCookieValidation'=&gt;true,<br>),<br>同时生成与得到cookie是要用 CHttpCookie<br><br><br>如何让表单验证不驼过的提示为中文<br>在main.php的配置中加上<br>'language' =&gt; 'zh_CN',<br><br>如何实现仿google的自动完成功能<br>&lt;?php $this-&gt;widget('CAutoComplete', array(<br>'name'=&gt;'xxx',<br>'url'=&gt;array('suggestTags'),<br>'multiple'=&gt;false,<br>'htmlOptions'=&gt;array('size'=&gt;50),<br>)); ?&gt;<br><br>然后在url指定的地址中的方法中如下输出,即可 <br>echo "a\nb\nc"<br><br><br><br><br><br><br>//CGridView详解<br>这东西在后台比较有用，能加速开发的速度，值得一看<br><br>CGridView用表格的方式显示数据项<br>每一行代表一个数据项,一列通常代表数据项的一个属性<br><br>CGridView支持排序和分页，可以用ajax或普通的方式<br><br>CgridView必序和data provider一起使用<br><br>最简单的用法<br><br>$dataprovider = new CActiveDataProvider('Post');<br>$this-&gt;widget('zii.widgets.grid.CGridView',array(<br>'dataProvider'=&gt;$dataprovider,<br>));<br>这会用表格的方式显示每一条数据项，每一列是Post的一个属性<br>在显示中带了分页和排序<br><br>我们可以自定义CgridView::columns属性，以自定义表格列的显示方式<br><br>这个cloumns如何配置呢?<br>其是一个数组，每一个数组元素对应着一列的配置，可以是字符串或数组<br>1、如果是字符串,格式是name:type:header 后两者是可选的,根据这三个值，创建一个CdatColumn实例<br>其中type参见CFormatter<br>2、如果是数组，其可以实例化CDdataColumn、ClinkColumn,CButtonColumn,CCheckBoxColumn实例，具体实例化哪个<br>由数组中的class指定，默认是CDataColumn<br>2.1,如果class=&gt;'CDataCloumn'<br>则可以指定name或者value,如果指定以value优先<br>用CDataColumn时如何以关联表的数据序列?<br>代码如下:表示可以post关联的author中的username排序列 <br>$dataprovider = new CActiveDataProvider('Post',array(<br>'criteria'=&gt;array(<br>'with'=&gt;'author',<br>),<br>'sort'=&gt;array(<br>'attributes'=&gt;array(<br>'title','create_time',<br>'author_id'=&gt;array('asc'=&gt;'author.username asc','desc'=&gt;'author.username desc'，'label'=&gt;'作者')<br><br>)<br>),<br>));<br>$this-&gt;widget('zii.widgets.grid.CGridView',array(<br>'dataProvider'=&gt;$dataprovider,<br>'columns'=&gt;array(<br>'title',<br>'create_time',<br>array('name'=&gt;'author_id','value'=&gt;'$data-&gt;author-&gt;username'),<br>),<br>));<br>另外CDataColumn还有一个filter属性，如果是空，那么生成一个textfield，如果是数组(键值)，则生成一个dropDownlist在当前列的上部，供搜索<br>2.2:如果class=&gt;"CLinkColumn"<br>array('class'=&gt;'CLinkColumn','label'=&gt;'查看用户','url'=&gt;Yii::app()-&gt;createURL('user/edit'))<br>则生成一个连接<br>2.3:如果class="CCheckBoxColumn"<br>array('class'=&gt;'CCheckBoxColumn','name'=&gt;'title','id'=&gt;'select'),<br>可以生成一个checkbox供选择,且只能选一个<br>可以配置CGridView::selectableRows 如果是0，则不能选，如果 1,只选一个如果是2或其它值，则可以选多个<br>代码如下:<br>$this-&gt;widget('zii.widgets.grid.CGridView',array(<br>'dataProvider'=&gt;$dataprovider,<br>'selectableRows'=&gt;2,<br>'columns'=&gt;array(<br>array('class'=&gt;'CCheckBoxColumn','name'=&gt;'title','id'=&gt;'select'),&nbsp;&nbsp; &nbsp;<br>),<br>2.3:如果class="CButtonColumn"<br>array(<br>'class'=&gt;'CButtonColumn',<br>'updateButtonUrl'=&gt;'Yii::app()-&gt;createUrl("post/edit",array("id"=&gt;$data-&gt;id));',<br>),<br>修改updateButtonUrl为编辑贴子<br><br><br><br>如何用gridview生成一个代搜索的管理列表<br>1、在Model的rules 设定可以搜索的属性<br>array('title, status, create_time', 'safe', 'on'=&gt;'search'),<br>2、在Model中,添加搜索时的方法<br>public function search()<br>{<br>$criteria=new CDbCriteria;<br><br>$criteria-&gt;compare('title',$this-&gt;title,true);<br><br>$criteria-&gt;compare('status',$this-&gt;status);<br><br>$criteria-&gt;compare('create_time',$this-&gt;create_time);<br><br>return new CActiveDataProvider('Post', array(<br>'criteria'=&gt;$criteria,<br>'sort'=&gt;array(<br>'defaultOrder'=&gt;'status, update_time DESC',<br>),<br>));<br>}<br>3、 在Controler中,写接受搜索用到的表单的值的方法<br>public function actionAdmin()<br>{<br>$model=new Post('search');<br><br>if(isset($_GET['Post']))<br>$model-&gt;attributes=$_GET['Post'];<br>$this-&gt;render('admin',array(<br>'model'=&gt;$model,<br>));<br>}<br>4、在view中用CGridView显示<br>设置好<br>&lt;?php $this-&gt;widget('zii.widgets.grid.CGridView', array(<br>'dataProvider'=&gt;$model-&gt;search(),<br>'filter'=&gt;$model,<br>'columns'=&gt;array(<br><br>),<br>)); ?&gt;<br><br>以上代码大部分是yii自动生成的，只要做少量修改即可<br>有时候会出现，搜索后页面为空的清况，原因可能是<br>layout/main.php中<br>echo $content外层无div，就是说main.php中必须有一个div包含$content<br><br>//CListView详解<br>其用列表的形式显示数据，不象CGridView一样，用表格显示数据，CListView用一个 view模板来显示每一条数据<br>其支持排序与分页<br><br>常用的代码如下<br>&lt;?php<br>$dataProvider = new CActiveDataProvider('Post',array(<br>'pagination'=&gt;array(<br>'pageSize'=&gt;2<br>),<br>));<br>$this-&gt;widget('zii.widgets.CListView',array(<br>'dataProvider'=&gt;$dataProvider,<br>'itemView'=&gt;'_view',<br>'template'=&gt;' {summary} {items}&nbsp; {pager}{sorter}',<br>'sortableAttributes'=&gt;array(<br>'title',<br>'create_time'=&gt;'Post Time',<br>),<br><br>));<br><br>//CActiveForm详解<br><br>快速生成表单，支持ajax验证，对于比较复杂的验下最好是自己生成表单，写验证方法<br>常用代码,在Controller中<br><br>public function actionForm()<br>{<br>$post = new Post();<br>if(isset($_POST['ajax']) &amp;&amp;&nbsp; $_POST['ajax']==='post'){<br>echo CActiveForm::validate($post);<br>Yii::app()-&gt;end();<br>}<br><br>if(isset($_POST['Post'])){<br>$post-&gt;attributes = $_POST['Post'];<br>if($post-&gt;save()){<br>echo '存成功了';<br>}<br>}<br>$this-&gt;render('form',array('post'=&gt;$post));<br>}<br>在view中<br><br>&lt;?php<br>$form = $this-&gt;beginWidget('CActiveForm',array(<br>'id'=&gt;'post',//这里与Controller中的ajax对应<br>'enableAjaxValidation'=&gt;true,<br><br>));<br>?&gt;<br>&lt;?php echo CHtml::errorSummary($post); ?&gt;<br>&lt;?php echo $form-&gt;labelEx($post,'title');?&gt;<br>&lt;?php echo $form-&gt;textField($post,'title')?&gt;<br>&lt;?php echo $form-&gt;error($post,'title'); ?&gt; error一定要写上，要不不会触发ajax验证<br><br>&lt;?php echo $form-&gt;labelEx($post,'content');?&gt;<br>&lt;?php echo $form-&gt;textField($post,'content')?&gt;<br><br>&lt;?php echo CHtml::submitButton($post-&gt;isNewRecord ? 'Create' : 'Save'); ?&gt;<br>&lt;?php $this-&gt;endWidget(); ?&gt;<br><br><br>//CBreadcrumbs常用代码<br>&lt;?php $this-&gt;widget('zii.widgets.CBreadcrumbs', array(<br>'links'=&gt;$this-&gt;breadcrumbs,<br>'homeLink'=&gt;'&lt;span&gt;&lt;a href="http://abc.com"&gt;shouye&lt;/a&gt;&lt;/span&gt;',<br>'separator'=&gt;'&gt;&gt;&gt;'<br>)); ?&gt;<br>其中breadcrumbs中Controller中的一个属性，如果要出现导航，就要在view中给此属性附值<br>生成的html如下<br>&lt;div class="breadcrumbs"&gt;<br>&lt;span&gt;&lt;a href="http://abc.com"&gt;shouye&lt;/a&gt;<br>&lt;/span&gt;&amp;gt;&amp;gt;&amp;gt;&lt;span&gt;Managde Posts&lt;/span&gt;&amp;gt;&amp;gt;&amp;gt;<br>&lt;span&gt;b&lt;/span&gt;&amp;gt;&amp;gt;&amp;gt;&lt;span&gt;c&lt;/span&gt;&lt;/div&gt;<br>所以如果网站用到导航的时候，美工最好把导航代码定义如上<br><br>//CDetailView&nbsp; 用在仅仅是为了查看数据时，还是比较有用的,比如用在后台<br><br><br>如何在提交后显示一段提示<br>在控制器中<br>if(isset($_POST['name'])){<br>Yii::app()-&gt;user-&gt;setFlash('success','you are success');<br>$this-&gt;refresh();<br>}<br>在view中<br>if (Yii::app()-&gt;user-&gt;hasFlash('success')){<br>echo 're is'.Yii::app()-&gt;user-&gt;getFlash('success');<br>}else{<br>echo 'no';<br>}<br><br>如何得到当前域名:<br>app()-&gt;request-&gt;hostInfo<br><br><br>activeDropDownList，给出提示，并有值 <br>array('empty'=&gt;array(0=&gt;'选择分组')<br><br><br>&lt;input type="submit" class="btn" value="提交" /&gt;<br><br>验证码如何生成及验证:<br>Controller中<br>public function actions()<br>{<br>return array(<br>'captcha'=&gt;array(<br>'class'=&gt;'CCaptchaAction',<br>'backColor'=&gt;0xFFFFFF,<br>'maxLength'=&gt;4,<br>'minLength'=&gt;4,<br>),<br>);<br>}<br>View中<br>&lt;?php echo CHtml::activeTextField($user, 'verifyCode');?&gt;<br>&lt;?php $this-&gt;widget('CCaptcha',array(<br>'captchaAction' =&gt; '/site/captcha',<br>'showRefreshButton' =&gt; false,<br>'clickableImage' =&gt; true,<br>'imageOptions' =&gt; array('align'=&gt;'top', 'title'=&gt;'重新获取'),<br>));?&gt;<br>Model中<br>array('verifyCode', 'captcha', 'captchaAction'=&gt;'site/captcha', 'message' =&gt; '输入的验证码不正确'),<br><br><br>set_time_limit(0);//禁止角本超时 <br><br><br>如何想把手工的东西记录的数据库<br>main.php中配置log<br><br>array(<br>'class'=&gt;'CDbLogRoute',<br>'levels'=&gt;'info',<br>'logTableName'=&gt;'Log',<br>'connectionID'=&gt;'db',<br>),<br>应用时<br>Yii::log('信息','info');<br><br>deleteAllByAttributes(array("phone"=&gt;$phones)直接接受一个数组，可以删除数组中符合条件的记录<br><br><br><br>YII_BLOG STUDY重新看了一遍yii blog，有些记录会与上边的重复<br><br><br>YII:Trace() 在debug模式是才记录信息，同时在main.php中的Log中的配置中的levels中要有trace,至于记录多少<br>栈由index.php中的YII_TRACE_LEVEL决定<br><br>配置Gii<br>'modules'=&gt;array(<br>'gii'=&gt;array(<br>'class'=&gt;'system.gii.GiiModule',<br>'password'=&gt;'123',<br>),<br>),<br><br>获得客户端IP<br>if($_SERVER['HTTP_CLIENT_IP']){ &nbsp;<br>$ip = $_SERVER['HTTP_CLIENT_IP']; &nbsp;<br>}elseif($_SERVER['HTTP_X_FORWARDED_FOR']){ &nbsp;<br>$ip = $_SERVER['HTTP_X_FORWARDED_FOR']; &nbsp;<br>}else{ &nbsp;<br>$ip = $_SERVER['REMOTE_ADDR']; &nbsp;<br>} &nbsp;<br><br>CActiveForm还是比较强大的，建议在以后的项目中form都用这个来实现<br><br>layout/中的视图是可以继承的<br>&lt;?php $this-&gt;beginContent('/layouts/main'); ?&gt;<br>然后在中间出现$content即可<br>&lt;?php $this-&gt;endContent(); ?&gt;<br><br>create,update最好是分开放在两个action中，共用一个form,中间可以加一层view,以在头尾显示不同的东西<br><br>成段的完成一个功能的代码尽量拿出来放到一个方法中<br><br><br>$this-&gt;beginWidget('CMarkdown', array('purifyOutput'=&gt;true));<br>echo $data-&gt;content;<br>$this-&gt;endWidget();<br><br><br>linkButton,在删除时需要用js提示，可以看下这此组件中的comfirm<br>而且他们的提交方式都是post,是因为在jquery.yii.js写死了<br>具体的以在源文件中低部找到那段js中的ajaxsubmit，所在的js看下<br><br><br>filter是在执行action之前或之后执行的一段代码，要应用filters必须得写<br>CController::filters()方法<br>为什么在filters方法写上<br>return array(<br>'accessControl', // perform access control for CRUD operations<br>);能进行crud验证呢？<br>accessController是CContronller内置的filter，其调用<br>accessRules，得到验证规定，所以也要重写对应的accessRules，返回一个验证规则的数组成部分<br><br><br><br><br>if the application uses modules, <br>a root alias is also predefined for each module ID and refers to the base path of the corresponding module<br><br>如：echo YiiBase::getPathOfAlias('bbs');得到module bbs的路径<br><br><br><br>关于CUrlManager<br>'模式'=&gt;'route'<br><br>matchValue是指，对于一个url规则，正常情况下是只看参数的名子是否一样就应用规则<br>如果matchValue=true,则也要看值<br>如,规则<br>'index-/&lt;id:\d+&gt;'=&gt;array("book/index",'matchValue'=&gt;false),<br><br><br>$this-&gt;createUrl('book/index', array('id'=&gt;'abcd'));可以应用以上规则的，<br>如果规则中的matchValue=true,则就不能应用了<br><br><br><br><br>XSS又叫CSS (Cross Site Script) ，跨站脚本攻击。<br>它指的是恶意攻击者往Web页面里插入恶意html代码，当用户浏览该页之时，<br>嵌入其中Web里面的html代码会被执行<br><br>renderPartial() <br>render()<br>后者会把需要的js,css等嵌入<br>前者可以通过把最后一个参数设置成true完成一样的功能<br><br>addInCondition 不用考虑数组是空的情况yii会自动处理<br><br>如何得到当前url?<br>Yii::app()-&gt;request-&gt;url;<br><br>ctype_开始的几个函数，用于检查字任串是不是符合要求，代替了简单的正则表达式<br><br>CController中的setPageState可以保存同一页中的POST的表单状态<br><br>如何通过BEhavior修改CActiveRecord?<br><br>写类文件继承自<br>class LLog extends CActiveRecordBehavior{<br>public function beforeDelete($event){<br>$model = get_class($this-&gt;Owner);<br>//做要做的事，比如日志或修改模型字段内容<br><br>}<br>}<br>然后修改模型文件<br>public function behaviors()<br>{<br>return array(<br>// Classname =&gt; path to Class<br>'LLog'=&gt;'application.behavior.LLog',<br>);<br>}<br><br>如何在应用程序处理请求之前执行一段操作？<br>在main.php中配置<br>'onBeginRequest' =&gt; 'function'<br>当然这个function方法要存在<br><br>也可以写在放口文件index.php中，代码改成如下<br>$app = Yii::createWebApplication($config);<br>$app-&gt;onbeginRequest = 'begin';<br>$app-&gt;run();<br>function begin(){<br>echo 'yyyyydddyyyyyy';<br>}<br><br><br><br><br>为什么在CActiveRecordBehavior中用<br>beforesave就可以代表了事件onBeforeSave<br>注意基为中最上边的events方法中返回的对应关系<br>'onBeforeSave'=&gt;'beforeSave'<br>在调用attacth（CBehavior中）的时候，<br>$owner-&gt;attachEventHandler($event,array($this,$handler));<br>就指定了事件onBeforeSave的处理函数是用本类中的beforeSave<br><br><br><br>YII中的CComponent，CEvent与Behavior及CActiveRecordBehavior个人理解<br>这一块教程少，今天个人理解了下,写了个小例子，有助于理解<br>完成如下功能，一个JTool类，继承CComponent,当其长度改变时，调用事件，输出"change me".<br>JTool.php在protected/components 下<br>&lt;?php<br>class JTool extends CComponent{<br>private $_width;<br>public function getWidth(){<br>return $this-&gt;_width ? $this-&gt;_width : 1; <br>}<br><br>public function setWidth($width){<br>if($this-&gt;hasEventHandler('onChange')){<br>$this-&gt;onChange(new CEvent());<br>}<br>$this-&gt;_width = $width;<br>}<br><br>public function onChange($event){<br>$this-&gt;raiseEvent('onChange', $event);<br>}<br><br>}<br><br>OK，功能已经实现了,找个控制器，执行<br>$j = new JTool();<br>$j-&gt;onChange = "showChange"; //给事件绑定handle showChange<br>$j-&gt;width = 100;&nbsp; //调用setWidth，解发绑定的事件showChange<br>function showChange(){<br>echo 'changed me';<br>}<br><br><br>现在我们想给JTool添加一个功能，返回长度的100倍,我们可以继承JTool.php写一个方法<br>class JToolSub extends JTool{<br>public function get100width(){<br>return $this-&gt;width*100;<br>}<br>}<br>OK,功能实现了,这个执行就简单了new JToolSub调用方法即可<br><br><br>上边的这两种办法，就是仅完成功能，下边演示Behavior及events来实现<br><br>如何用Behavior来实现上边的增加一个方法，返回长度的100倍的功能呢？<br>写类JBe<br>JBe.php在protected/behavior 下<br><br>class JBe extends&nbsp; CBehavior{<br><br>public function get100width(){<br>return $this-&gt;Owner-&gt;width*100;<br>}<br>}<br><br>OK,功能已经实现了，找个控制器，执行<br>$j = new JTool();<br>$j-&gt;attachBehavior('JBe', 'application.behavior.JBe');<br>echo $j-&gt;get100width();<br><br><br>如何用Behavior实现JTool中的长度改变时，调用一个事件的功能呢？<br>写类JBe<br><br>class JBe extends&nbsp; CBehavior{<br>public function events(){<br>return array_merge(parent::events(),array(<br>'onChange'=&gt;'change',<br>));<br>}<br><br>public function change(){<br>echo 'changed';<br>}<br><br>public function get100width(){<br>return $this-&gt;Owner-&gt;width*100;<br>}<br>}<br><br>OK,功能实现随便找个控制器，执行<br>$j = new JTool();<br>$j-&gt;attachBehavior('JBe', 'application.behavior.JBe');<br>$j-&gt;width = 100;<br><br><br>这里的要点是events方法<br>返回的数组array('onChange'=&gt;'change')定义了事件(event)和对应的事件处理方法(event hander)<br><br>事件是是Compents(JTool中)定义的,即JTool中的onChange<br>处理方法同由Behavior(JBe中)类定义的,即JBe中的change<br><br>这样子再看CActiveRecordBehavior，其是绑定给CActiveRecord 这个组件的，绑定方法重写behaviors()<br>CActiveRecordBehavior中的events() 方法返回事件及事处理函数的对应，如:<br>'onBeforeSave'=&gt;'beforeSave'<br><br>即组件CActiveRecord中的onBeforeSave这个事件对应的处理函数是<br>CActiveRecordBehavior中的beforeSave方法<br><br>这样子CActiveRecord在调用save()时，触发事件onBeforeSave,调用CActiveRecordBehavior对应的处理函数beforeSave<br>我们只要写一个CActiveRecordBehavior的子类，重写其中的beforeSave，执行一些操作,然后给CActiveRecord绑定即可<br><br><br><br><br>如果你自己有个目录下有些类或文件常用，可以在main.php的最上边定义一个路径别名<br>Yii::setPathOfAlias('local','path/to/local-folder');<br>如果是多个可以在main.php中的array中加一个配置<br>'aliases'=&gt;array(<br>'local'=&gt;'path/to/local/'<br>),<br><br>如何得到proteced目录的物理路径？<br>YII::app()-&gt;basePath;<br><br><br><br>widget是发布资源<br>$url = Yii::app()-&gt;getAssetManager()-&gt;publish(Yii::getPathOfAlias('application.components.homeuserlived'));<br>cs()-&gt;registerCoreScript('jquery');<br>cs()-&gt;registerScriptFile($url.'/location.js' ,CClientScript::POS_HEAD);<br>cs()-&gt;registerScriptFile($url.'/YLChinaArea.js' ,CClientScript::POS_HEAD);<br>cs()-&gt;registerCssFile($url.'/style.css');<br><br><br>如何写application component, 即在main.php可配置<br>"my"=&gt;array('')<br>可以通过Yii::app()-&gt;my来访问？<br>继承CApplicationComponent即可，并可以自带Behavior等<br><br><br>yii中读写session的两种方法<br><br>$session = Yii::app()-&gt;session;<br>$session['terry'] = 30;<br>var_dump($session['key']);<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br>Yii::app()-&gt;user-&gt;setState('tom', '40');<br>var_dump(Yii::app()-&gt;user-&gt;getState('key', 'default'));<br><br><br><br>==========================================分隔线===================================<br>soap非yii教程，意思是不用yii框架的时候要对象提供webservice的写法<br><br>分两种WSDL模式，和非WSDL模式，先看后者<br><br>这个也比较简单，服务器端<br>server.php<br><br>&lt;?php<br>ini_set('soap.wsdl_cache_enabled',0);<br>class Student {<br>/**<br>* <br>* @param string $name<br>* @param int $age<br>* @return string<br>*/<br><br>public function getInfo($name,$age){<br>if($age == 20){<br>throw new SoapFault(-1, 'Cannot divide by zero!'); <br>}<br>$xml = "&lt;root&gt;&lt;name&gt;".$name."&lt;/name&gt;";<br>$xml .= "&lt;age&gt;".$age."&lt;/age&gt;&lt;/root&gt;";<br>return&nbsp; $xml;<br><br>}&nbsp;&nbsp; &nbsp;<br>}<br>$soapS = new SoapServer(null,array('uri' =&gt; 'http://www.dayouhui.com'));<br>$soapS-&gt;setClass('Student');<br>$soapS-&gt;handle();<br>?&gt;<br><br>客户端client.php<br>&lt;?php<br>$soap = new SoapClient(null,array('location'=&gt;"http://localhost/mysoap/index.php",'uri'=&gt;'inadex.php'));<br><br>echo $soap-&gt;getInfo('a','b');<br><br>这样子即可<br>=============================================<br>yii，Componnts那快，忘了，写了个小例子回忆了下<br><br>是写一个可以写在main.php中的Components并绑定行为，事件<br>======================================<br>class ExtWindow extends CApplicationComponent{<br><br>private $title = 'title';<br>public $oldtitle;<br>public function getTitle(){<br>return $this-&gt;title ? $this-&gt;title : 'old title&lt;br /&gt;';<br>}<br><br>public function setTitle($title){<br>echo '=='.$this-&gt;oldtitle.'==';<br>$this-&gt;oldtitle = $this-&gt;title;<br>$this-&gt;title = $title;<br>if($this-&gt;hasEventHandler('onTitleChange')){<br>$event =new CEvent($this);<br>$this-&gt;raiseEvent('onTitleChange', $event);<br>}<br><br>}<br>//必须有这么个方法，其和raiseEent中的事件一样,具体看代码<br>public function onTitleChange($event){<br><br>}<br><br>}<br>===========================<br>&lt;?php<br>class Window extends CBehavior{<br>public function events(){<br>return array_merge(parent::events(),array(<br>'onTitleChange'=&gt;'titleChange',<br>));<br>}<br><br>public function titleChange($event){<br>echo $event-&gt;sender-&gt;title;<br>echo 'event TitleChange is handled in Behavior&lt;br /&gt;';<br>echo $this-&gt;owner-&gt;title;<br>}<br><br>public function titleOld(){<br>echo&nbsp; '&lt;br /&gt;old title is is&nbsp; '.$this-&gt;owner-&gt;oldtitle;<br>}<br>}<br>==============================<br>main.php中的写法<br>'ExtWin'=&gt;array(<br>'class' =&gt; 'ExtWindow',<br>'oldtitle'=&gt;'我是旧的',<br>'behaviors'=&gt;array('win'=&gt;'application..behavior.Window')<br><br><br>=============================================<br>一对多，多对多的关联时最后的参数 together说明<br>如果为false,分开查多个语句<br>如果为true,强制生成一个语句<br>如果没有设置,分页页生成多个语句，不分页时生成一个语句 <br>),<br>多对多时，查询时，中间表的名子叫 (关联名_关联名)<br><br>with选项的作用是eager loading<br>together的作用是 要不要形成一个语句<br><br>当是一个sql语句是记录会有重复，这时候分页分出现相同的记录，加上group=&gt;true即可,<br><p>只要弄明白了，你生成的sql是一条还是多条sql就明白在多对多查询时的结果了 </p><p>&nbsp;</p><p>两个表不是用主键关联</p><p>'user' =&gt; array(self::BELONGS_TO, 'OaskUser', '','on'=&gt;'name=userName', 'select'=&gt;'TrueName'),</p><br></div></td></tr></table>

<br>

<div class="opt">

<a href="/48238398/blog/category/Php5" title="查看该分类中所有文章">类别：Php5</a>

| <a  href="#" onclick="addToShare(); return false;" target="_blank"><img src="http://img.baidu.com/hi/apps/share/share_btn.gif" border="0" align="absbottom"  /></a>




	

	| <a title="将此文章添加到百度搜藏" href="http://cang.baidu.com/do/add" onClick="return addToFavor();" target="_blank">添加到搜藏</a>

	
    | <a title="将此文章分享到i贴吧" href="#" onclick="addToiTieba(); return false;"  target="_blank">分享到i贴吧</a>

	| 浏览(<span id="result"></span>)

	| <a href="#send">评论</a>&nbsp;(1)



<script language="javascript">

/*<![CDATA[*/

var pre = [true,'FLEX3 点滴', 'FLEX3 点滴','/48238398/blog/item/f43fe7c2218818160ff4772b.html'];

var post = [true,'引用js时乱码的解决','引用js时乱码的解决', '/48238398/blog/item/274c75d1bbe0fb369a5027ec.html'];

if(pre[0] || post[0]){

	document.write('<div style="height:5px;line-height:5px;">&nbsp;</div><div id="in_nav">');

	if(pre[0]){

		document.write('上一篇：<a href="' + pre[3] + '" title="' + pre[1] + '">' +  pre[2] + '</a>&nbsp;&nbsp;&nbsp;&nbsp;');

	}

	if(post[0]){

		document.write('下一篇：<a href="' + post[3] + '" title="' + post[1] + '">' +  post[2] + '</a>');

	}

	document.write('</div>');

}

/*]]>*/

</script>



</div>

 
<div class="line">&nbsp;</div>
<div id="share_user_list"></div>


<div class="line">&nbsp;</div>







    
<style type="text/css">

/*<![CDATA[*/

#in_related_doc a { text-decoration:none; }

/*]]>*/

</style>

<div id="in_related_tmp"></div>


    













<div id="in_reader">
    <div class="tit">最近读者：</div>

</div>





<div class="line">&nbsp;</div>










<div id="in_comment">

    <a name="comment"></a>

    <div class="tit">网友评论：</div>

    <span id="userCommentList"></span>    

    <div id="page"></div>

</div>

<form action='/48238398/commit' id='blogCmtSubmitForm'  name='blogCmtSubmitForm' method='post'>
    <input type='hidden' name='bdstoken' value='73e111e722dd6740a7d9bf92cbc0f78d'>
    <input type='hidden'  name='ct' value='8'>
    <input type='hidden'  name='cm' value='2'>
    <input type='hidden'  name='spBlogID' value='7f5f72ad3679bc044a36d634'>
    <input type='hidden'  name='spBlogCmtID' value=''>
    <input type='hidden'  name='spRefURL' value=''>
</form>






<div id="in_send">

<a name="send"></a>

<form name="form1" id="popFormSubmit" action="/48238398/commit" method="post" onSubmit="return checkcmtform()">

<input type="hidden" name="bdstoken" value="73e111e722dd6740a7d9bf92cbc0f78d">

<input type="hidden" name="ct" value="8">

<input type="hidden" name="cm" value="1">

<input type="hidden" name="spBlogID" value="7f5f72ad3679bc044a36d634">

<input type="hidden" name="spRefURL" id="spRefURL" />

<script>

    document.getElementById("spRefURL").value = window.location.href;

</script>

<div class="tit">发表评论：</div>

<table width="620" border="0" cellspacing="5" cellpadding="0">





<tr id="2_err" style="display:none">

<td>&nbsp;</td>

<td><div class="error" id="2_err_con"></div></td>

</tr>



<tr>

<td valign="top" class="f14" id="reTitle">内　容：</td>

<td>
	<textarea name="spBlogCmtText" id="spBlogCmtText" style="width:520px;height:155px"  tabindex="3" onFocus="hidErr(3);" onclick="BdUtil.relogin(); return false;" ></textarea>
</td>

</tr>

<tr id="3_err" style="display:none">

<td>&nbsp;</td>

<td><div class="error" id="3_err_con"></div></td>

</tr>




<tr>

<td valign="top"class="f14">&nbsp;</td>

<td valign="top" class="f14"><input id="btn_ok" name="btn_ok" type="submit" autocomplete="off" onclick="BdUtil.relogin(); return false;" value="发表评论" tabindex=5>&nbsp;&nbsp;&nbsp;&nbsp;<a href="#" id="cancleReLink" onClick="canclereply(); return false;" style="display:none; font-size:12px;color:#666;">取消回复</a></td>

</tr>

</table>

</form>

</div>









<br>

</div>



<table width="100%" border="0" cellspacing="0" cellpadding="0" height="8">

<tr><td class="modbl" width="7">&nbsp;</td>

<td class="modbc">&nbsp;</td>

<td class="modbr" width="7">&nbsp;</td>

</tr></table>







</div>

</div>



</div>



</div>



<br><center><div id="ft">&copy;2011 Baidu</div></center>


</center>

<ul id="blogCmtContentList" style="display:none;">

 <li id="blogCmtContent_1">楼主 看来用了不短时间咯 转载咯：）<br></li>

</ul>

<!--inc_getmsgnum.html-->

<iframe id="submitiframe" name="submitiframe" src="/st/blank.html" style="display:none;"></iframe>


<script type="text/javascript" src="/ui/scripts/blog/detailpage.js?v=1.1"></script>
<script type="text/javascript">
    //*****there is some function。
    function checkMail(s)

    {

        var pattern=/\w+@\w+\.[a-z]+/;

        if(pattern.test(s))

        {

           return true;

        }

        else

       {

          return false;

       }

    }





    function checkeandu(eanduid)

    {

        var eanduvalue=baidu.G(eanduid).value;

        var len=baidu.string.getByteLength(eanduvalue);

        if(len>128)

        {

            showErr(2,"您输入的网址或邮箱太长，请保持在128字节以内。");

            return false;

        }

        else

        {

             return true;

        }



    }





    function checkname(strid)

    {

        var ele=baidu.G(strid);

        var len=baidu.string.getByteLength(ele.value);

        if(len>49)

        {

            showErr(1,"您输入的姓名太长，请保持在49字节以内。");

            return false;

        }

        else

        {

            if(len==0)

            {

                baidu.G(strid).value="匿名网友";

            }

             return true;

        }



    }



    function checktext(textid)

    {

            var tempStr='';

            var isLightFont=false;

            if(editor&&textid=="spBlogCmtText"){

                tempStr=editor.getHtml();
                
                /*
                //火星文处理，能不碰它就别碰它
                tempStr=tempStr.replace(/<span style="filter:glow\(color=#([0-9a-z]{3,6}),strength=2\);height:0px;color:#([0-9a-z]{3,6})">/ig,'');

                tempStr=tempStr.replace(/<\/span>/ig,'');
                */

                baidu.G("spBlogCmtText").value=tempStr;

                isLightFont=!(tempStr==editor.getHtml());

            }


            var str=baidu.string.trim(baidu.G(textid).value);
            baidu.G(textid).value=str;

            

            len=str.length;

            if(len==0 || ((/^[\s,　]+$/gi).test(str)) )

            {

                showErr(3,"您必须输入评论内容，请检查。");

                return false;

            }

            else

            {

                    var maxLength=isLightFont?916:1000;

                    if(len > maxLength)

                    {

                        showErr(3,"您输入的评论内容太长，请保持在500字以内。");

                        return false;

                    }

                    if(editor&&textid=="spBlogCmtText"){

                        baidu.G("spBlogCmtText").value=editor.getHtml();

                        baidu.G(textid).value=str;

                    }



                return true;

            }

    }



    function showErr(index,str)

    {

        baidu.G(index+"_err").style.display="";

        baidu.G(index+"_err_con").innerHTML=str;

    }

    function hidErr(index)

    {

        baidu.G(index+"_err").style.display="none";

        baidu.G(index+"_err_con").innerHTML="";

    }



    function alertPop(tit,con)

    {

        var pop=new Popup({ contentType:4,isReloadOnClose:false,width:340,height:80});

        pop.setContent("title",tit);

        pop.setContent("alertCon",con);

        pop.build();

        pop.show();

    }



    function cmtfull()

    {

        var cnum=1;

        if(cnum>=50000)

        {

            alertPop("发表评论","单篇日志评论数最多为50000条.");

            return false;

        }

        else

        {

            return true;

        }

    }


	function showCmtSuccess(){
		ShareBlog.showCmtShareResult(0);
	}


    function checkcmtform()

    {

        if(checkname("spBlogCmtor")&&checkeandu("spBlogCmtURL")&&checktext("spBlogCmtText")&&cmtfull())

        {
            if(baidu.g("shareBlog").checked && !ShareBlog.isHostReply){
                baidu.g("shareBlogEchoback").value = "shareblog"; 
                ShareBlog.submit(Session.spToken);
            }else{
                baidu.g("shareBlogEchoback").value = "";
            }
            submitForm();

            return true;

        }

        else

        {

            return false;

        }

    }



    var g_pop=null;

    function submitForm()

    {

        g_pop=new Popup({ contentType:1,isReloadOnClose:false,width:340,height:80});

        g_pop.setContent("title","添加评论");

        g_pop.setContent("contentUrl","");

        g_pop.setContent("someDisabledBtn","btn_ok");

        g_pop.build();

        G("popFormSubmit").target=g_pop.iframeIdName;

        g_pop.show();

    }



    function g_close_pop()

    {

        g_pop.close();

    }



    function formatonlinpic()

    {

        var picobj=document.getElementsByName("onlinepic");

        var picnum=picobj.length;



        for(var i=0;i<picnum;i++)

        {

            if(picobj[i].width>200)

            {

                picobj[i].width=200;

            }

            if(picobj[i].height>200)

            {

                picobj[i].height=200;

            }

        }

        try{baidu.G("btn_ok").disabled = "";}catch(e){}

    }



    function addToFavor(){

        var blogTitle='YII 点滴(更新中)'.replace(/&#39;/g,'\'');

        window.open('http://cang.baidu.com/do/add?it='+encodeURIComponent(blogTitle+'_百度空间')+'&iu='+encodeURIComponent(location.href)+'&fr=sp#nw=1','_s','scrollbars=no,width=600,height=450,right=75,top=20,status=no,resizable=yes');

        return false;

    }

    function addToiTieba(){
        var blogTitle='YII 点滴(更新中)'.replace(/&#39;/g,'\'');
        window.open('http://tieba.baidu.com/i/sys/share?link='+encodeURIComponent('http://hi.baidu.com/48238398/blog/item/7f5f72ad3679bc044a36d634.html')+'&type=text&title='+encodeURIComponent(blogTitle)+'&content=');
    }

    function addToShare(){
        window.open('http://apps.hi.baidu.com/share/?url='+encodeURIComponent('http://hi.baidu.com/48238398/blog/item/7f5f72ad3679bc044a36d634.html'));
    }


    /* some functions for cmt-reply */
    var g_cmtorInfo = [];
    function goCmtReply(cmtPorID){
        //如果是主人的话，回复别人的评论，是不需要显示分享的
        

        cmtreply(g_cmtorInfo[cmtPorID],cmtPorID);
    }
    function cmtreply(cmtName,cmtPorID)

    {

        cmtName=cmtName.replace(/<|>/g,"");

        window.location.hash="#send";

        var cmtForm=document.form1;

        cmtForm.cm.value="3";

        if(!cmtForm.spReferTarget)

        {

            var ipt=document.createElement("input");

            ipt.type="hidden";

            ipt.name="spReferTarget";

            ipt.value=cmtPorID;

            cmtForm.appendChild(ipt);

        }else cmtForm.spReferTarget.value=cmtPorID;





         //G("reTitle").innerHTML="回复"+cmtName+"：";

         G("cancleReLink").style.display="";

         cmtForm.btn_ok.value="回复评论";





         try{

            editor.window.focus();

            editor.window.document.body.innerHTML="回复"+cmtName+"：";



            var w = editor.window;

            if(w.getSelection){

                var d = w.document;

                var s = w.getSelection();

                var r = d.createRange();

                r.setStartAfter(d.body.firstChild);

                r.setEndAfter(d.body.lastChild);

                s.removeAllRanges();

                s.addRange(r);

            }

        }catch(e){

                try{

                    cmtForm.getElementsByTagName("textarea")[0].focus();

                    cmtForm.getElementsByTagName("textarea")[0].value="回复"+cmtName+"：";

                }catch(e){}

        }

    }



    function canclereply()

    {
        //主人可以分享自己的文章
        ShareBlog.cancelReply();

        var cmtForm=document.form1;

        cmtForm.cm.value="1";

        try{cmtForm.removeChild(cmtForm.spReferTarget);}catch(e){}

        /*

        try{

                var cmt=cmtForm.getElementsByTagName("textarea")[0]

                cmt.value="";

                cmt.focus();

        }catch(e){}

        */



        try{

                var ed=editor.window.document.body;

                ed.innerHTML="";

                editor.window.focus();

            }catch(e){

                var cmt=cmtForm.getElementsByTagName("textarea")[0];

                cmt.value="";

                cmt.focus();

        }



        G("cancleReLink").style.display="none";

        cmtForm.btn_ok.value="发表评论";

    }



    function gotoreply()

    {//to checking whether reply cmt

        if( window.location.hash.indexOf("&re=1")<0) return;

        var cmtID=window.location.hash.split("&")[0].replace("#","");

        var cmtlinks=document.getElementsByTagName("a");

        for(var i=0,n=cmtlinks.length;i<n;i++)

        {

            if(cmtlinks[i].name==cmtID){ var rename=cmtlinks[i].getAttribute("rename");  repid=cmtlinks[i].getAttribute("repid"); break;}

        }

        if(typeof(rename)!="undefined"){

            cmtreply(rename, repid);

        }

    }

    
    
    function f_focus(){
        getVcode();
    }
    function getVcode(){
        var url="http://hi.baidu.com/sys/file/getvcode?echoback=getVcodeDone&t="+(new Date().getTime());
        BdAjax.loadJS(url)
    }

    function getVcodeDone(vcode){
        document.form1.spVcode.value=vcode;
        var imgsrc="http://hiup.baidu.com/cgi-bin/genimg?"+vcode;
        G('verifypic').src=imgsrc;
        G('yanzheng').style.display="block";
    }
    function newverifypic(){
        getVcode();
        return false;
    }

    function blogdel(str)

    {

        var pop=new Popup({ contentType:3,isReloadOnClose:false,width:340,height:80});

        pop.setContent("title","删除文章");

        pop.setContent("confirmCon","您确定要彻底删除这篇文章及其所有评论吗？");

        pop.setContent("callBack",delCallback);

        pop.setContent("parameter",{fid:str,popup:pop});

        pop.build();

        pop.show();

        return false;

    }

    
    function delCallback(para)

    {
        if(!para["popup"])return;

        var o_pop=para["popup"];

        o_pop.config.contentType=1;

        o_pop.setContent("contentUrl","");

        o_pop.reBuild();

        G(para["fid"]).target=o_pop.iframeIdName;
        eval("document.draft"+para["fid"]).submit();

        eval("document."+para["fid"]).submit();

    }



    var _Space = _Space || {};
    
    /********这里的东西，是用来生成评论列表的**********/
    _Space.commentOperate = (function(){
        
        function getCmtTpl(){
            
            var cmtStrTpl = [];
                        
            cmtStrTpl.push('<a name="#{cmtid}" rename="#{cmtuser}" repid="#{cmtportrait}"></a>');
            cmtStrTpl.push('<table width="100%" border="0" cellspacing="0" cellpadding="0" class="item" style="table-layout:fixed;word-wrap:break-word;overflow:hidden;"><tr>');
            cmtStrTpl.push('<td valign="top" class="index" width="5%">#{cmtindex}</td>');
            cmtStrTpl.push('<td align="center" valign="top" width="10%">');
            cmtStrTpl.push('<div class="user" style="overflow:hidden;">#{cmtuserhead}</div>');
            cmtStrTpl.push('</td><td class="cnt" style="padding-left:20px;">');
            cmtStrTpl.push('<span class="date">#{cmttime} #{mobileup} #{cmtreplay} #{cmtdel}</span>');
            cmtStrTpl.push('<div class="desc" style="overflow:hidden;word-break:normal;"  name="cmtcontent">#{cmtcontent}</div></td>');
            cmtStrTpl.push('</tr></table>');
            cmtStrTpl.push('<div class="line">&nbsp;</div>');

            return cmtStrTpl.join('');
        }

        function getUserPortrait(type,cmtid,cmtname,cmturl,portraitId){
            var html1="";

        	if(type==1){

			    html1="<a href='"+cmturl+"' target='_blank' class='ucard' pid="+portraitId+"><img  border='0' src='http://tx.bdimg.com/sys/portraitn/item/"+portraitId+".jpg'><br>"+cmtname+"</a>";

            }else{

                if(cmtname=="" || cmtname=="匿名网友"){

                    if(cmturl==""){

                        html1="<a>匿名网友</a>";

                    }else{

                        html1="<a href='"+cmturl+"' target='_blank' class='ucard' pid="+portraitId+">"+cmtname+"</a>";

                    }

                }else{

                    if(cmturl==""){

                        html1="<div class='f14' style='display:inline'>网友:<a>"+cmtname+"</a></div>";

                    }else{

                        html1="<div class='f14' style='display:inline'>网友:<a href='"+cmturl+"' target='_blank' title='"+cmturl+"'>"+cmtname+"</a></div>";

                    }

                }

            }

            return html1;
        }

        function renderCmt(cmtdata){
            var tpl = getCmtTpl();

            var mobileup=cmtdata.isMobileUp? '<a  href="http://hi.baidu.com/hi/cms/article/help_phone/index.html" target="_blank" style="text-decoration:none;">来自手机<img src="http://img.baidu.com/hi/img/mobile.gif" align="absmiddle" border="0" /></a>' : '';

            var cmtreplay =(cmtdata.isCanReply && cmtdata.isCmtAllow)? ( cmtdata.isAnonymity ? ' | <a href="#" onclick="BdUtil.relogin();return false;">回复</a>' : ' | <a href="#" onclick="goCmtReply(\'#{cmtportrait}\');return false;">回复</a>') : '';

            var cmtdel = Session.isHost ? ' | <a href="#" onClick="_Space.commentOperate.deleteCmt(\'#{cmtid}\'); return false;">删除</a> | <a href="#" onclick="userSpam.tipBlogCmt(this, \'#{cmtuser}\' ,\'#{cmtid}\', \'#{blogid}\') ; return false;">举报</a>' : '';

            var cmtuserhead = getUserPortrait(cmtdata.userType,"#{cmtid}","#{cmtuser}","#{cmturl}","#{cmtportrait}");

            mobileup = baidu.string.format(mobileup, cmtdata);
            cmtreplay = baidu.string.format(cmtreplay, cmtdata);
            cmtdel = baidu.string.format(cmtdel, cmtdata);
            cmtuserhead = baidu.string.format(cmtuserhead, cmtdata);

            cmtdata.mobileup = mobileup;
            cmtdata.cmtreplay = cmtreplay;
            cmtdata.cmtdel = cmtdel;
            cmtdata.cmtuserhead = cmtuserhead;


            return baidu.string.format(tpl, cmtdata);
        }

        
        function deleteCmt(cid){
            var pop=new Popup({ contentType:3,isReloadOnClose:false,width:340,height:80});

            pop.setContent("title","删除评论");

            pop.setContent("confirmCon","您确定要彻底删除这条评论吗？");

            pop.setContent("callBack", function(){
            
                var o_pop=pop;
                var _F = baidu.G('blogCmtSubmitForm');
                _F.spBlogCmtID.value=cid;
                _F.spRefURL.value = window.location.href;

                o_pop.config.contentType=1;

                o_pop.setContent("contentUrl","");

                o_pop.reBuild();

                _F.target=o_pop.iframeIdName;

                _F.submit();
            });

            pop.build();

            pop.show();

            return false;
        }
    

        function showCmtList(){
            var cmtDataList = getCmtDataList();
            var cmtList = [];

            baidu.each(cmtDataList, function(item, index){
                cmtList.push( renderCmt(item) );
            });

            baidu.G('userCommentList').innerHTML = cmtList.join('');

            filterCmtContent('userCommentList');
        }

        function getCmtDataList(){
            var cmtDataList=[];

            
    
            g_cmtorInfo["9c2fd0fcb7c72200"] = "悬非"; //评论用户列表。 因为xss，所以改成了现在这个搓样子。
            
            cmtDataList.push({
                cmtid : "530f05232fb0fa5c9922ed65",
                cmtuser : "悬非",
                cmturl : "http://hi.baidu.com/xuanfei2046",
                cmtportrait : "9c2fd0fcb7c72200",
                cmttime : "2010-09-12  20:27",
                // spBlogCmtTextList。 但是因为不能编码，所以就先到html里吧。。
                cmtcontent : baidu.G('blogCmtContent_1').innerHTML,  
                cmtindex : "1",
                isMobileUp :  false ,
                isCanReply :  true ,
                isCmtAllow :  true ,
                isisAnonymity :  true ,
                userType :  1 ,
                blogid : "7f5f72ad3679bc044a36d634"
            });

            

            return cmtDataList;
        }
        
        
        function filterCmtContent(n){

            if(!baidu.browser.ie){

                var defaultfilter1='<span style="filter:glow(color=#000000,strength=2);height:0px;color:#000000">';

                var defaultfilter2='<span style="height: 0px; color: rgb(0, 0, 0);">';

                var commentDiv=document.getElementById(n);

                var divs=commentDiv.getElementsByTagName('div');

                var d,tmp;

                for( var i=0,len=divs.length;i<len;i++){

                    d=divs[i];

                    if(d.getAttribute('name')=='cmtcontent'){

                        tmp=d.innerHTML;

                        tmp=tmp.replace(/<span style="filter:glow\(color=#([0-9a-z]{3,6}),strength=2\);height:0px;color:#([0-9a-z]{3,6})">/ig,defaultfilter1);

                        tmp=tmp.replace('<span style="height: 0px; color: rgb(255, 255, 255);">',defaultfilter2);

                        d.innerHTML=tmp;

                    }

                }

            }

        }

        return {
            showCmtList : showCmtList,
            deleteCmt : deleteCmt
        }
        
    })();
    
    /**********分享该文章的用户功能**********/
    
    _Space.BlogSharedUser=(function(){

        function showList(obj){
            var count = obj.count || 0,i=0,html=[],len=obj.list.length,item;
            if(count && len){
                html[html.length] = '<div class="tit" style="margin-bottom:12px;">已有'+count+'人分享了这篇文章：</div>';
                html[html.length] = '<table width="100%"><tbody><tr>'
                for(;i<len;i++){
                    item=obj.list[i];
                    html[html.length] = '<td width="10%" valign="bottom" align="center" class="user"><a class="ucard" target="_blank" pid="'+item.portrait+'" href="http://hi.baidu.com/sys/checkuser/'+item.uname+'/3"><img border="0" src="http://tx.bdimg.com/sys/portraitn/item/'+item.portrait+'.jpg" style="display:block"><div style="width:75px;overflow:hidden;height:18px;">'+item.uname+'</div><a href="http://apps.hi.baidu.com/share/user/'+item.portrait+'" target="_blank">Ta的分享</a></a></td>';
                }
                html[html.length] = '<td width="100%"></td></tr></tbody></table>';
                G('share_user_list') && (G('share_user_list').innerHTML = html.join(''));
                SP.mycard.bind('share_user_list'); 
            }
        }

        function getData(){
            var url = "http://apps.hi.baidu.com/share/getsourceshare?url=http://hi.baidu.com"+encodeURIComponent("/48238398")+"/blog/item/7f5f72ad3679bc044a36d634.html&callback=_Space.BlogSharedUser.showList&asyn=1&r="+Math.random();
            BdAjax.loadJS(url);
        }

        return {
            getData : getData,
            showList : showList
        }
    })();
    

    
    /*********相关文章的显示函数********/
    _Space.RelatedDoc=(function(){

        function HI_MOD_IN_RELATED_DOC_CALLBACK(arg){

            if(arg.length <= 1) return false;

            var hasMore = arg[0];

            var D=function(A,B){A[A.length]=B;}

            if(arg.length % 2 == 0) D(arg, ["","","",""]);



            var html = ['<div id="in_related_doc" onclick="relative_Click()"><div class="tit">相关文章：</div>'];

            D(html, '<table cellpadding="0" cellspacing="3" border="0">');

            for(var i = 1, j = arg.length; i < j; i += 2){

                D(html, '<tr>');

                D(html, '<td width="15px"><a style="font-size:25px" >&#8226;</a></td><td><a href="http://hi.baidu.com/' + arg[i][3] + '/blog/item/' + arg[i][2] + '.html" target="_blank" title="' + arg[i][0] + '">' + arg[i][1] + '</a>');

                D(html, new Array(10).join('\u3000'));

                D(html, '</td>');

                if(arg[i + 1][0] != "")

                    D(html, '<td width="15px"><a style="font-size:25px" >&#8226;</a></td><td><a href="http://hi.baidu.com/' + arg[i + 1][3] + '/blog/item/' + arg[i + 1][2] + '.html" target="_blank" title="' + arg[i + 1][0] + '">' + arg[i + 1][1] + '</a></td>');

                else

                    D(html, '<td>&nbsp;</td><td>&nbsp;</td>');

                D(html, '</tr>');

            }

            if(hasMore) D(html, '<tr><td colspan="4"><a target="_blank" href="/sys/search?pageno=1&type=7&sort=1&word=YII%20%B5%E3%B5%CE%28%B8%FC%D0%C2%D6%D0%29&item=7f5f72ad3679bc044a36d634">更多&gt;&gt;</a></td></tr>');

            D(html, '</table></div><div class="line">&nbsp;</div>');



            var div = document.getElementById('in_related_tmp');

            if(div){

                div.innerHTML = html.join('');

                while(div.firstChild){

                    div.parentNode.insertBefore(div.firstChild, div);

                }

                div.parentNode.removeChild(div);

            }


        }

        window.HI_MOD_IN_RELATED_DOC_CALLBACK = HI_MOD_IN_RELATED_DOC_CALLBACK;

        function show(){
            if( baidu.G('in_related_tmp') )
            baidu.sio.callByServer("/sys/search?type=8&word=YII%20%B5%E3%B5%CE%28%B8%FC%D0%C2%D6%D0%29&item=7f5f72ad3679bc044a36d634");
        }

        return {
            show : show
        }

    })();
    

    /*********最近读者*********/
    _Space.latestReader=(function(){
        var g_read=[

        

        ["darwinwen","a08264617277696e77656e5b08","darwinwen"],

        

        ["hongjingyuan","2115686f6e676a696e677975616e0f02","hongjingyuan"],

        

        ["ttn329","c2c574746e3332397000","ttn329"],

        

        ["76476567","3bab3736343736353637040b","76476567"],

        

        ["songjianlovewxj","e0e8cceccab97068704b09","天使php"],

        

        ["chorylee","347763686f72796c65651401","chorylee"],

        

        ["done%5Fgone","5c38646f6e655f676f6e65b80b","done_gone"],

        

        ["qijunz","2b1871696a756e7ae406","qijunz"],

        

        {}

        ];

        g_read.length=g_read.length-1;



        var _rh1="";

        var _rh2="";



        function show(){

            _rh1 += '<table width="100%" ><tr>';

            _rh2+='<tr>';

            if(!Session.isLogin){

                _rh1+='<td align="center" width="10%" ><img border="0" width="55" height="55" src="http://img.baidu.com/hi/img/portraitn.jpg"></td>';

                _rh2+='<td>&nbsp;</td>';

                if(g_read.length>0){

                    _rh1+='<td align="left" width="12%">';

                }else{

                    _rh1+='<td align="left" width="100%">';

                }

                _rh1+='<a href="https://passport.baidu.com/?login&tpl=sp&tpl_reg=sp&u='+myref+'" target="_self" onclick="BdUtil.relogin(); return false;">登录</a>后，您就出现在这里。</td>';

                _rh2+='<td>&nbsp;</td>'

            }

            if(g_read.length==0){

                if(Session.isLogin){

                    _rh1+='<td align=left width="100%">最近还没有登录用户看过这篇文章……</td>';

                    _rh2+='<td>&nbsp;</td>';

                }

            }else{

                for(i=0,len=g_read.length;i<len;i++){

                    _rh1+='<td align="center" valign="bottom" width="10%" class="user"><a href="/'+g_read[i][0]+'" target="_blank" class="ucard" pid="'+g_read[i][1]+'"><img border="0" src="http://tx.bdimg.com/sys/portraitn/item/'+g_read[i][1]+'.jpg"></a></td>';

                    _rh2+='<td align="center" valign="top" class="user"><a href="/'+g_read[i][0]+'" target="_blank" class="ucard" pid="'+g_read[i][1]+'">'+g_read[i][2]+'</a></td>';

                }

            }

            _rh1+='<td width="100%"></td></tr>';

            _rh2+='<td></td></tr></table>';


            baidu.dom.insertHTML("in_reader", "beforeEnd", _rh1+_rh2);

        }

        return {
            show : show
        }
    })();
    

    /*********页面完成后执行的一些东西，比较乱，小心轻放**********/
    _Space.pageDone = (function(){
        
        function initBlogTextForFCK(){
            //fck init music
            if(window.Node){Node.prototype.replaceNode=function(Node){this.parentNode.replaceChild(Node,this);}}
            var imgBox=document.getElementsByName('musicName');
            var isAutoPlay=true;
            for(var i=0,n=imgBox.length;i<n;i++){
                var img=imgBox[i];
                if(img.getAttribute('rel')){
                    var musicSrc=img.getAttribute('rel');
                    var musicDiv = document.createElement("SPAN");
                    var tmp=musicSrc.substr (musicSrc.indexOf('#')+1, 1);
                    var tmpAutoPlay=(tmp=='1');
                    if(isAutoPlay&&tmpAutoPlay){
                        isAutoPlay=false;
                        tmpAutoPlay=true;
                    }else{
                        tmpAutoPlay=false;
                    }
                    var shtml=creatbgmusic(musicSrc.substr(0,musicSrc.indexOf('#')).replace(/[\s><()'"]+/g,''),1,true,false,tmpAutoPlay,tmpAutoPlay,'FckMusicHelper');
                    shtml=shtml.replace('width=100%','width=200').replace('width="100%"','width=200 height=45');			img.replaceNode(musicDiv);
                    musicDiv.innerHTML=shtml;
                    i--;n--;
                }
            }
                //fck init vote
            !function(){
                var vote = document.getElementsByName('FCK_VOTE');
                for(var i=0,len=vote.length,item,rel=0,cdiv;i<len;i++){
                    item = vote[0];
                    rel = item.getAttribute('rel')|0;
                    if(rel){
                        cdiv = document.createElement('span');
                        item.parentNode.replaceChild(cdiv,item);
                        baidu.swf.create({
                            "id": "VOTE_FLASH_"+i,
                            "width" : "585",
                            "height": "100",
                            "ver"   : "9.0.0",
                            "wmode" : document.all ? "opaque" : "window",
                            "allowscriptaccess" : "always",
                            "url"   : "http://hi.bdimg.com/apps/appvote/spaceVote.swf?vote_id="+rel
                        },cdiv)

                    }
                }
            }()
            //document.getElementById('blog_text').style.display='';
        }
        
        function resizeBlogImg(){

            if(document.getElementById("m_blog"))

            {

                var imgarray = document.getElementById("m_blog").getElementsByTagName('img');

                var imgw = document.getElementById("m_blog").offsetWidth;

                imgw =imgw-40;

	            var imgs = []
                for(var i=0; i<imgarray.length; i++){
                    if(imgarray[i].className=="blogimg" && imgarray[i].width>=imgw) {
                        imgs[i]=new Image();
                        (function(_imgarray,_imgs,_i){
                            _imgs[_i].onload=function(){
                                var h=imgw/_imgs[_i].width*_imgs[_i].height;
                                _imgarray[_i].height = h;
                                _imgarray[_i].style.height=h+'px';
                            };
                        })(imgarray,imgs,i);
                        imgs[i].src=imgarray[i].src;
                        imgarray[i].width=imgw;
                        imgarray[i].style.width=imgw+'px';
                    }
                }
            }
        }

        function fixURLCopyBug(){
        
            // Fix ff bugs

            var blog_text = document.getElementById('blog_text');
            /**

            blog_text.innerHTML = blog_text.innerHTML.replace(/href\s*=\s*("|')?(\.\.\/\.\.\/)/gi,"href=$1../$2");
            */
            /*modify by poker, to fix the flashalbum's static domain*/
            var _blog_trans = blog_text.innerHTML.replace(/href\s*=\s*("|')?(\.\.\/\.\.\/)/gi,"href=$1../$2");
            _blog_trans = _blog_trans.replace(/http:\/\/hi\.baidu\.com\/static\/album\/album\.swf/g,"http://hi.bdimg.com/static/album/album.swf");
            blog_text.innerHTML = _blog_trans;
        }

        function getPVData(){

            var hstr="";

            baidu.sio.callByServer("/48238398/brwstat?key1=1&key2=b5f7533820e8b8f2b311c733_7f5f72ad3679bc044a36d634_");   
        } 

        function setpv(allnum)

        {

            var num = allnum.split('_');

            baidu.G("result").innerHTML=num[0];

        }

        window.setpv = setpv;
        
        function initCmtEditor(){ //初始化浏览编辑器
            var editor=null;

            try{

                editor=new BdEditor("spBlogCmtText",{width:"100%",height:"155px"});

                editor.onfocus = function(){hidErr(3);}

                editor.render();

                //如果用户没有登陆，焦点进入编辑器，弹出登录框
				
                var editorCont=editor.window;
				baidu.Q("ToolbarContainer",baidu.G("in_send"))[0].style.display="none";
                baidu.on(editorCont,"focus",function(){
				BdUtil.relogin();
				return false;
				});
				

            }catch(e){

                var spBlogCmtText = document.getElementById("spBlogCmtText");
                if(!spBlogCmtText ) return false;

                var p = spBlogCmtText.previousSibling;

                while(p && p.nodeType != 1) p = p.previousSibling;

                if(p && /bdeditor_container/.test(p.id)){

                    p.parentNode.removeChild(p);

                }

                spBlogCmtText.style.display = '';

                editor=null;

            }

            

            window.editor = editor;
        }

        function ok(){
            getPVData();
            resizeBlogImg();
            fixURLCopyBug();
            initBlogTextForFCK();
            initCmtEditor();

            gotoreply(); /* external fun*/
        }

        return {
            ok : ok
        }
    })();
	
	function relative_Click(){
		BdUtil.ns_trackerLink('m_20110329_relative_article','')
	}
    /********分段加载处理对象，实验性功能*********/
    _Space.SectionLoad = (function(){

        var loaded = false;

        var sectioinList = [];

        function complete(item){
            item.isComplete = true;
        }

        function add(mod, loadCallback){

            var mod = baidu.G(mod);
            
            sectioinList.push({"mod": mod, "callback":loadCallback});
        }

        function startLoad(item){
            item['callback']();
            complete(item);
        }

        function checkStat(){
            if(sectioinList.length <= 0) return;

            var pageTop2bottom=getPageTop2bottom();
            
            baidu.each(sectioinList, function(item, index){

                if(! item.isComplete){
                    if(getOffsetTop(item.mod)-100 <= pageTop2bottom)
                        startLoad(item);
                }
            });
        }

        function getOffsetTop(mod){
            return baidu.dom.getPosition(mod).top;
        }

        function getPageTop2bottom(){
            var dsh = baidu.page.getScrollTop();
            var dch = baidu.page.getViewHeight();

            return dsh + dch;
        }

        
        baidu.on(window, 'resize', checkStat);
        baidu.on(window, 'onload', checkStat);
        baidu.on(window, 'scroll', checkStat);
        
        return {
            "add" : add
        } 
    })();

    /*******Start Working！*******/
    var _pageEndTime=(new Date().getTime()) - g_pageTimerStart;

    baidu.on(window, 'load', function(){
        var _pageLoadTime=(new Date().getTime()) - g_pageTimerStart;

        BdUtil.hi_trackerLink('m_20101109_blogloadtime', _pageLoadTime+'|'+_pageEndTime);
    });

    /**********Step2***********/
    _Space.pageDone.ok();

    baidu.G('share_user_list') && _Space.SectionLoad.add('share_user_list', _Space.BlogSharedUser.getData);
    baidu.G('in_related_tmp') && _Space.SectionLoad.add('in_related_tmp', _Space.RelatedDoc.show);
    baidu.G('in_reader') && _Space.SectionLoad.add('in_reader', _Space.latestReader.show);
    baidu.G('in_comment') && _Space.SectionLoad.add('in_comment', _Space.commentOperate.showCmtList);
</script>



			


<script type="text/javascript">
/*<![CDATA[*/

var SP = SP || {};
if(!SP.mycard){
    SP.mycard = new (function(){
        var me = this;
        var _cancleAction = Session.isDrag;  
        var _list = [];
        var _sourceLoaded = false;    
        me.bind = function (_id){
            if(_cancleAction){  //abort
                return;
            }
            if(!_sourceLoaded){
                _list.push(_id);
            } else {
                baidu.space.mycard.bind(_id);
            }
        }
        me.init = function (_config){
            _cancleAction = !!_config.cancle;
        }
        me.onSourceLoaded = function (){
            _sourceLoaded = true;
            baidu.space.mycard.init({portrait: Session.visitorPortrait});
            for(var i=0,len=_list.length; i<len; i++){
                baidu.space.mycard.bind(_list[i]);
            }
        }
    })();
    baidu.dom.ready(function(){
        BdAjax.loadCSS('/ui/css/ucard/ucard.css?v=020507100.css');
        BdAjax.loadJS('/ui/scripts/ucard/ucard.js?v=020507100.js');
    });
}
SP.mycard.bind('m_blog');  
/*]]>*/
</script>


	
    
<link rel="stylesheet" type="text/css" href="/ui/css/userset.css" />
<link rel="stylesheet" type="text/css" href="/ui/css/beautify/widget.css" />

<script type="text/javascript" src="http://hi.baidu.com/hi/cms/article/beautifyconfig/default_user_suit.js"></script>

<script type="text/javascript">
//页面状态变量
var Session = Session || {
    spaceURL: "/48238398",
    pageURL: "http://hi.baidu.com/48238398/blog/item/7f5f72ad3679bc044a36d634%2Ehtml",    //当前访问的url
    isHost: "",         // 是否是空间主人
    userName: "48238398",   // 空间主人用户名
    userNameEnc:    "48238398", 
    visitorName:    "",
    visitorURL: "/index.html",        // 
    refer: "http://hi.baidu.com/sys/search?type=1&sort=1&entry=1&region=4&hi=48238398&word=yii",
    spBasicURL:"48238398",
    spBasicURLEnc:"48238398"
};
</script>
<script src="/ui/scripts/beautify/render.js" type="text/javascript"></script>
<script type="text/javascript">
baidu.dom.ready(function(){
    if(typeof spBeautifyConfigData != 'undefined'){
        var _installList = spBeautifyConfigData.list;
    } else {
        spBeautifyConfigData = {};
        _installList = [];
    }
    spBeautifyConfigData.currentDate  = Math.round((new Date('2011/05/04')).getTime() / 1000);    
    BeautifyWidget.init({timeStamp: spBeautifyConfigData.currentDate, env: 'sys'});
    BeautifyWidget.render(_installList);
	if(Space && Space.ActiveTip){
		if(baidu.g("active_space")){
			window.active_tip=new Space.ActiveTip("tary_space_name",function(){
				active_tip.hidden();
				//activeSpace("pop_tip");
				if(BdUtil && BdUtil.ns_trackerLink){
					BdUtil.ns_trackerLink('nm_20101018_activeBlank',''); 
				}
				window.open('http://hi.baidu.com/reg/preihome?pageDomain=pop_tip');
			//	window.location.href="http://hi.baidu.com/reg/preihome?pageDomain=pop_tip";
				setTimeout(function(){
					window.location.reload();
				},1000);
				
			
			});
		}
		window.succTip=function(spaceUrl){
			active_dia.close();
			//var tiphtml="<div><div class='setBlackcon'>恭喜您，激活成功！欢迎入驻百度空间！</div><div class='setBlackpanel'><div class='blackConfirmbtn' onclick=\"goIhome('"+spaceUrl+"')\">确认</div></div></div>";
			BdDialog.Alert("恭喜您，激活成功！欢迎入驻百度空间！");
			baidu.g("dialogYES").onclick=function(){
				window.location.reload();
			};	
		};
	}
	
});
</script>



<script type="text/javascript" src="http://hi.baidu.com/hi/cms/article/quickjs/auto.js"></script>
<script>
try{SCD.init("http://hi.baidu.com/sys/search?type=1&sort=1&entry=1&region=4&hi=48238398&word=yii")}catch(e){}
</script>


</body></html>